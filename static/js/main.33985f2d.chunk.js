(this["webpackJsonpauthzyin-example"]=this["webpackJsonpauthzyin-example"]||[]).push([[0],{64:function(e,t,n){e.exports=n(78)},78:function(e,t,n){"use strict";n.r(t);var r,a=n(0),o=n(9),c=n(15),i=n(24),l=n(19),u=n(14),s=n(16),f=n(49),m=n(50),p=n(17),d=n.n(p),h=n(29),v="".concat(".","/policies.json"),E="".concat(".","/places.json"),b=function(){var e=Object(h.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if(!(n=e.sent).ok){e.next=9;break}return e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 9:throw new Error(n.status.toString());case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(E);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();!function(e){e.SetPlaces="SetPlaces",e.SetCurrentPlace="SetCurrentPlace",e.SetAlert="SetAlert"}(r||(r={}));var y,j,O=Object(s.a)(r.SetPlaces),w=Object(s.a)(r.SetCurrentPlace),C=Object(s.a)(r.SetAlert),P={getPlaces:function(){return function(){var e=Object(h.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:n=e.sent,t(O(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},setAlert:C,setCurrentPlace:w,enterPlace:function(e){return function(t){console.log('Entered "'.concat(e.name,'" successfully.')),t(w(e.id)),t(C({severity:j.Info,message:'You just walked into "'.concat(e.name,'"')}))}}},x=function(){return Object(s.c)(P)};!function(e){e.Info="info",e.Warn="warning",e.Error="error"}(j||(j={}));var T,k,S,q=Object(s.b)({places:[],currentPlace:-1},(y={},Object(i.a)(y,r.SetPlaces,[function(e,t){return Object(l.a)(Object(l.a)({},e),{},{places:t.payload,currentPlace:-1})}]),Object(i.a)(y,r.SetCurrentPlace,[function(e,t){return Object(l.a)(Object(l.a)({},e),{},{currentPlace:t.payload})}]),y)),A={severity:j.Info,message:"Which place do you want to go?"},R=Object(s.b)(A,Object(i.a)({},r.SetAlert,[function(e,t){return Object(l.a)(Object(l.a)({},e),t.payload)}])),I=Object(u.combineReducers)({places:q,alertInfo:R}),G=Object(u.createStore)(I,Object(f.composeWithDevTools)(Object(u.applyMiddleware)(m.a))),z=n(58),J=n(104),N=n(108),W=n(107),F=n(79),H=n(42);function L(e){return e.operator===T.Or}function D(e){return(e.operator===T.Equals||e.operator===T.Contains||e.operator===T.GreaterThan||e.operator===T.GreaterThanOrEqualTo)&&void 0!==e.dataJPath}(S=T||(T={}))[S.Invalid=-100]="Invalid",S[S.RequiresRole=-1]="RequiresRole",S[S.Or=1]="Or",S[S.Equals=2]="Equals",S[S.GreaterThan=3]="GreaterThan",S[S.GreaterThanOrEqualTo=4]="GreaterThanOrEqualTo",S[S.Contains=5]="Contains",function(e){e[e.ContextToResource=1]="ContextToResource",e[e.ResourceToContext=2]="ResourceToContext"}(k||(k={}));var M=function e(t,n,r){var a=!1;return L(n)?a=function(t,n,r){for(var a=0;a<n.children.length;a++)if(e(t,n.children[a],r))return!0;return!1}(t,n,r):function(e){return e.operator===T.RequiresRole}(n)?a=function(e,t){for(var n=t.allowedRoles,r=e.userContext.roles,a=0;a<n.length;a++)if(r.indexOf(n[a])>=0)return!0;return!1}(t,n):D(n)&&(a=function(e,t,n){var r;if(D(r=t)&&void 0!==r.constValue&&(n={value:t.constValue}),!n)return!1;var a=Object(H.a)({path:t.dataJPath,json:e.data}),o=Object(H.a)({path:t.resourceJPath,json:n});return function(e,t,n){if(!e||!t||e.length<=0||t.length<=0)return!1;switch(n){case T.Equals:case T.GreaterThan:case T.GreaterThanOrEqualTo:return 1===e.length&&e.length===t.length&&(n===T.Equals&&e[0]===t[0]||n===T.GreaterThan&&e[0]>t[0]||n===T.GreaterThanOrEqualTo&&e[0]>=t[0]);case T.Contains:return 1===t.length&&e.some((function(e){return e===t[0]}));default:return!1}}(t.direction===k.ContextToResource?a:o,t.direction===k.ContextToResource?o:a,t.operator)}(t,n,r)),a};function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var B,U=function(e){if(!e)return e;for(var t=e.length,n="",r=0;r<t;){var a=e.indexOf(".",r);n+=e.substr(r,(a=-1===a?t:a+1)-r),a<t&&"."!==e[a]&&(n+=e[a].toLowerCase(),a++),r=a}return n},V=function(){var e=B;if(!e)throw new Error("AuthZyin React context is not setup. Call createAuthZyinContext first.");return Object(a.useContext)(e)},Y={url:"/authzyin/context",requestInitFn:function(){return Promise.resolve({})},jsonPathPropToCamelCase:!0},$=function(e){var t=Object(a.useState)(),n=t[0],r=t[1],o=V();return Object(a.useEffect)((function(){var t=Z({},Y,null==e?void 0:e.options),n=function(e){t.jsonPathPropToCamelCase&&function(e){e&&e.policies&&e.policies.forEach((function(e){var t;(t=e)&&t.requirements&&t.requirements.length>0&&t.requirements.forEach((function(e){return function e(t){L(t)&&t.children?t.children.forEach((function(t){return e(t)})):D(t)&&(t.dataJPath=U(t.dataJPath),t.resourceJPath=U(t.resourceJPath))}(e)}))}))}(e),r(e)};o?n(o):function(){try{Promise.resolve(t.requestInitFn()).then((function(e){return e.method="GET",e.body=void 0,Promise.resolve(fetch(t.url,e)).then((function(e){return function(){if(e.ok)return Promise.resolve(e.json()).then((function(e){n(e)}));throw new Error("AuthZyinContext loading error: "+e.status)}()}))}))}catch(e){return Promise.reject(e)}}()}),[e]),Object(a.createElement)(B.Provider,{value:n},n&&n.userContext&&e.children)},K=function(){var e=V();return function(t,n){return e&&e.userContext&&function(e,t,n){if(!e||!e.policies)return!1;var r=e.policies.filter((function(e){return e.name===t}))[0];if(!r||!r.requirements)return!1;for(var a=r.requirements,o=0;o<a.length;o++)if(!M(e,a[o],n))return!1;return!0}(e,t,n)}},Q=function(e){var t=K();if(!(null==e?void 0:e.children))return Object(a.createElement)(a.Fragment,null);var n=t(e.policy,e.resource);return e.children(n)},X=n(100),_=n(102),ee=n(103),te=n(51),ne=n.n(te),re=function(e){var t=e.data;return a.createElement(X.a,{variant:"outlined"},a.createElement(_.a,{title:"Client authorization context"}),a.createElement(ee.a,null,a.createElement(ne.a,{src:t,theme:"summerfruit",iconStyle:"triangle",collapsed:2,enableClipboard:!1})))},ae=n(36),oe=function(){var e=V();return e?a.createElement("div",null,a.createElement(X.a,{variant:"outlined"},a.createElement(_.a,{title:"User information"}),a.createElement(ee.a,null,a.createElement(ae.a,{variant:"body1",component:"div"},"Age: ",e.data.age),a.createElement(ae.a,{variant:"body1",component:"div"},"Has driver's license: ",String(e.data.withDriversLicense)),a.createElement(ae.a,{variant:"body1",component:"div"},"Has passport: ",String(e.data.withPassport)),a.createElement(ae.a,{variant:"body1",component:"div"},"PaymentMethods: ",JSON.stringify(e.data.paymentMethods.map((function(e){return e.type}))))))):a.createElement(a.Fragment,null)},ce=n(43),ie=function(e){return e.places},le=Object(ce.a)([ie],(function(e){return e.places})),ue=(Object(ce.a)([ie],(function(e){return e.currentPlace})),function(e){return e.alertInfo}),se=n(110),fe=function(){var e=Object(c.c)(ue);return e.message?a.createElement(se.a,{severity:e.severity},e.message):a.createElement(a.Fragment,null)},me=n(105);var pe=n(4),de=n(109),he=Object(pe.a)((function(e){return{tooltip:{backgroundColor:e.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:e.shadows[1],fontSize:11}}}))(de.a),ve=n(56),Ee=n.n(ve),be=n(57),ge=n.n(be),ye=Object(J.a)((function(e){return{button:{margin:e.spacing(1)}}})),je=function(e,t){return a.createElement(a.Fragment,null,a.createElement(ae.a,{color:"inherit"},e.name),a.createElement(ae.a,{color:"secondary"},"accepts ".concat(e.acceptedPaymentMethods[0].toString())),a.createElement(ae.a,{color:"secondary"},function(e){return void 0!==e.maxAge}(e)&&"Age:".concat(e.minAge,"-").concat(e.maxAge)),a.createElement(ae.a,{color:t?"primary":"error"},t?"Authorized":"Not authorized"))},Oe=function(e){return function(e){return void 0!==e.hasHappyHour}(e)?a.createElement(Ee.a,null):a.createElement(ge.a,null)},we=function(e){var t=K()(e.place.policy,e.place);return a.createElement(he,{key:e.place.id,placement:"top",arrow:!0,title:je(e.place,t)},a.createElement(me.a,{variant:"contained",className:e.buttonClass,color:t?"primary":"secondary",startIcon:Oe(e.place),onClick:function(){return e.onEnterPlace(t)}},e.place.name))},Ce=function(e){return a.createElement(Q,{policy:e.place.policy,resource:e.place},(function(t){return a.createElement(he,{key:e.place.id,placement:"top",arrow:!0,title:je(e.place,t)},a.createElement(me.a,{variant:"contained",className:e.buttonClass,color:t?"primary":"secondary",startIcon:Oe(e.place),onClick:function(){return e.onEnterPlace(t)}},e.place.name))}))},Pe=function(e){var t=e.place,n=ye(),r=x(),o=r.setAlert,c=r.setCurrentPlace,i=r.enterPlace,l=function(e){c(-1),e?i(t):(console.error('Entering "'.concat(t.name,'": not authorized')),o({severity:j.Warn,message:'Authorization failed - "'.concat(t.name,'" forbidden by policy "').concat(t.policy,'"')}))};return t.id%2===0?a.createElement(we,{place:t,onEnterPlace:l,buttonClass:n.button}):a.createElement(Ce,{place:t,onEnterPlace:l,buttonClass:n.button})},xe=Object(J.a)((function(){return{placelist:{display:"flex",flexDirection:"row",justifyContent:"space-between"}}})),Te=function(){var e=xe(),t=Object(c.c)(le),n=x().getPlaces;if(a.useEffect((function(){n()}),[n]),t&&t.length>=0){var r=t.map((function(e){return a.createElement(Pe,{key:e.id,place:e})}));return a.createElement(X.a,{variant:"outlined"},a.createElement(_.a,{title:"Local places nearby you"}),a.createElement(ee.a,null,a.createElement(ae.a,{variant:"subtitle1",component:"div"},"Hover to see more details. Click to enter"),a.createElement("div",{className:e.placelist},r),a.createElement(fe,null)))}return a.createElement(a.Fragment,null)},ke=n(106),Se=function(){var e=V();return a.createElement("div",null,a.createElement(ae.a,{variant:"h2",component:"h2"},"Welcome ",e.userContext.userName,"!"),a.createElement(ke.a,{container:!0,direction:"column",justify:"center",alignItems:"stretch"},a.createElement(ke.a,{item:!0,xl:12},a.createElement(Te,null)),a.createElement(ke.a,{item:!0,xl:12},a.createElement(oe,null)),a.createElement(ke.a,{item:!0,xl:12},a.createElement(re,{data:e}))))},qe=Object(z.a)({palette:{type:"dark"}}),Ae=Object(J.a)((function(){return{root:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}}));!function(e){if(B)throw new Error("AuthZyin React context is already initialized.");B=Object(a.createContext)(e)}();var Re=function(){var e=Ae();return a.createElement($,{options:{url:v}},a.createElement(W.a,null,a.createElement(N.a,{theme:qe},a.createElement(F.a,{className:e.root},a.createElement(Se,null)))))},Ie=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ge(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.render(a.createElement(c.a,{store:G},a.createElement(Re,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat(".","/service-worker.js");Ie?function(e){fetch(e).then((function(t){var n=t.headers.get("content-type");404===t.status||n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ge(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):Ge(e)}))}}()}},[[64,1,2]]]);
//# sourceMappingURL=main.33985f2d.chunk.js.map